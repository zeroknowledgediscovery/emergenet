

\pgfplotsset{
    discard if/.style 2 args={
        x filter/.code={
            \edef\tempa{\thisrow{#1}}
            \edef\tempb{#2}
            \ifx\tempa\tempb
                \def\pgfmathresult{inf}
            \fi
        }
    },
    discard if not/.style 2 args={
        x filter/.code={
            \edef\tempa{\thisrow{#1}}
            \edef\tempb{#2}
            \ifx\tempa\tempb
            \else
                \def\pgfmathresult{inf}
            \fi
        }
    }
  }

  \begin{tikzpicture}[font=\bf\sffamily\fontsize{8}{10}\selectfont]
  \def\TEXTCOL{gray}
  \tikzset{
    hatch distance/.store in=\hatchdistance,
    hatch distance=20pt,
    hatch thickness/.store in=\hatchthickness,
    hatch thickness=2pt
  }


\pgfplotsset{
    accommodate labels/.code 2 args={
        \newlength{\myl}
        \pgfplotstableread{#1}\data
        \def\largestlength{0}
        \pgfplotstableforeachcolumnelement{#2}\of\data\as\cell{
            \settowidth{\myl}{\pgfinterruptpicture\cell\endpgfinterruptpicture}
            \pgfmathsetmacro\largestlength{max(\the\myl,\largestlength)}
        }
        \pgfplotsset{
            enlarge x limits={
                upper,              value=1/(1-(\largestlength+4pt)/\pgfkeysvalueof{/pgfplots/width})-1
            }
        }
    }
}

\def\COLDR{white}
\definecolor{alizarin}{rgb}{0.82, 0.1, 0.26}
\definecolor{amber}{rgb}{1.0, 0.75, 0.0}
\definecolor{amethyst}{rgb}{0.6, 0.4, 0.8}
\definecolor{apricot}{rgb}{0.98, 0.81, 0.69}
\definecolor{atomictangerine}{rgb}{1.0, 0.6, 0.4}
\definecolor{awesome}{rgb}{1.0, 0.13, 0.32}
\definecolor{azurec}{rgb}{0.0, 0.5, 1.0}
\definecolor{ballblue}{rgb}{0.13, 0.67, 0.8}
\definecolor{bittersweet}{rgb}{1.0, 0.44, 0.37}
\definecolor{bluem}{rgb}{0.0, 0.5, 0.69}
\definecolor{brightturquoise}{rgb}{0.03, 0.91, 0.87}
\definecolor{fiveA}{HTML}{30a2da}
\definecolor{fiveB}{HTML}{fc4f30}
\definecolor{fiveC}{HTML}{e5ae38}
\definecolor{fiveD}{HTML}{6d904f}
\definecolor{fiveE}{HTML}{8b8b8b}



\def\COLBA{Red4}
\def\COLBB{alizarin}
\def\COLBI{Red1}
\def\COLBG{MediumBlue!70}
\def\COLBC{DodgerBlue3}
\def\COLBD{Green2}
\def\COLBE{fiveE}
\def\COLBF{SeaGreen3}
\def\COLBH{Cyan3}
\def\COLBJ{bittersweet}
\def\COLBK{Orchid3}
\def\COLBL{black}
\def\COLDM{amber}
\def\COLML{DarkGreen!90}
\def\COLPA{Orchid4}

\def\CINF{Red4}
\def\CNEO{SeaGreen4}
\def\CIMM{Red1}
\def\CBLD{Red2!20}
\def\CNRV{fiveA}
\def\CCIR{Green2}
\def\CRSP{fiveE}
\def\CDIG{bittersweet}
\def\CSKN{Cyan3}
\def\CMSK{Indigo}
\def\CCNT{Orchid3}
\def\CPRI{MediumBlue!80}
\def\CINJ{amber}
\def\CMNT{DarkGreen!90}
\def\CGNT{DarkOrange3}
\def\CILL{black}
\def\HCOL{black}
\def\HBLK{gray}


  
  % \makeatletter
  % \pgfdeclarepatternformonly[\hatchdistance,\hatchthickness]{flexible hatch}
  % {\pgfqpoint{0pt}{0pt}}
  % {\pgfqpoint{\hatchdistance}{\hatchdistance}}
  % {\pgfpoint{\hatchdistance-1pt}{\hatchdistance-1pt}}%
  % {
  %   \pgfsetcolor{\tikz@pattern@color}
  %   \pgfsetlinewidth{\hatchthickness}
  %   \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
  %   \pgfpathlineto{\pgfqpoint{\hatchdistance}{\hatchdistance}}
  %   \pgfusepath{stroke}
  % }
  % \makeatother
  % \pgfdeclarepatternformonly{north east lines wide}%
  % {\pgfqpoint{-1pt}{-1pt}}%
  % {\pgfqpoint{10pt}{10pt}}%
  % {\pgfqpoint{9pt}{9pt}}%
  % {
  %   \pgfsetlinewidth{0.4pt}
  %   \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
  %   \pgfpathlineto{\pgfqpoint{9.1pt}{9.1pt}}
  %   \pgfusepath{stroke}
  % }


  \def\COMPA{\DATA/figfiles/SPECTRUMFcodes.csv}
  % \def\COMPB{\DATA/figfiles/age_3_mf_logodds_s_Fcodes.csv}
  % \def\COMPA{Figures/NEWMcodes.csv}
  % \def\COMPB{Figures/NEWFcodes.csv}
  % \def\COMPMF{\DATA/figfiles/mf_logodds_c_MFComp.csv}
  % \def\COMPMFA{\DATA/figfiles/age_3_mf_logodds_c_MFComp.csv}
  % \def\COMPMF{Figures/NEW1YRMFComp.csv}
  % \def\COMPMFA{Figures/NEWMFComp.csv}
  
  \def\WDTXX{1.85in}
  \def\WDTX{1.75in}
  \def\WDTXC{1.95in}
  \def\HGTX{9.25in} 
  \def\HGTXB{6.85in}
  \def\HGTXC{4in}
  \def\OPC{.9}
  \def\BWIDTH{7.5pt}
  \def\BWIDTHB{8pt}
  \def\BWIDTHC{6pt} 
  \def\BWIDTHD{5pt}


  

\clip (.8in,0.25in) rectangle (9.25in,-9.25in);

  
    \node [anchor=north west,align=left] (A) at (0,0) {
        \begin{tikzpicture}[text=\TEXTCOL]
%
 %  \def\basis{1}
%   \pgfplotsset
%   {
%     x coord trafo/.code={\pgfmathparse{symlog(#1,\basis)}\pgfmathresult},
%     x coord inv trafo/.code={\pgfmathparse{symexp(#1,\basis)}\pgfmathresult},
%     xticklabel style={/pgf/number format/.cd,int detect,precision=2},
% }


          \begin{axis}[legend style={anchor=east,at={(0.5,1.05)},inner sep=3pt,draw=none,fill=white,fill opacity=.850,align=right,text opacity=1,font=\bf\sffamily\fontsize{8}{9}\selectfont},axis line style={lightgray, opacity=0, thin},%
        enlargelimits=false,
        anchor=north west,
        height=\HGTX,
        width=\WDTXX,
        % xbar,
        ytick=data,% crucial line for the xticklabels directive 
        xmin=2,
        %xmax=2000,
        %accommodate labels={\DISX}{description},
        yticklabels from table={\COMPA}{code},
        yticklabel style
        ={font=\bf\sffamily\fontsize{7}{7}\selectfont,
          align=right,rotate=0, text width=1.1in,
          anchor=east, yshift=0in,xshift=-.0450in,text=\TEXTCOL},
        major tick length=0pt,,text opacity=1,
        %xticklabel style=
        %{font=\bf\sffamily\fontsize{7}{7}\selectfont,
        %  text=\TEXTCOL},
        %grid,
        grid style={lightgray, dashed,opacity=.70},
        axis on top=false, bar width=\BWIDTH,
        xlabel={log odds ratio of normalized prevalence},
        scaled x ticks=false,
        xlabel style={yshift=0.05in,text=\TEXTCOL,text opacity=1},
        ylabel style={xshift=-.25in,yshift=0.075in,text=\TEXTCOL,text opacity=1},
        enlarge y limits=.0150,
         x tick label style={/pgf/number format/fixed,/pgf/number format/precision=2,/pgf/number format/fixed zerofill,
     /pgf/number format/1000 sep = %\thinspace % Optional if you want to replace comma as the 1000 separator 
   },
   nodes near coords,,visualization depends on=x \as \rawx,
    every node near coord/.append style={anchor=west,align=left, text width=2in,font=\sffamily\rm\fontsize{8}{8}\selectfont,text=darkgray,text opacity=1,
        shift={(axis direction cs:0.01*\rawx,0)}},
   point meta=explicit symbolic,ylabel={},
   , %xtick ={-0.03,0,0.03},
  % xmax=0.03,xmin=-0.03,
        ] 

        \addplot[draw=none,fill=none,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn,meta=description
        ] {\COMPA};

        \def\DISMM{\COMPA}
        
          \addplot[draw=\CINF,fill=\CINF,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{0.0}
        ] {\DISMM};
          \addplot[draw=\CNEO,fill=\CNEO,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{1.0}
        ] {\DISMM};
        \addplot[draw=\CIMM,fill=\CIMM,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{2.0}
        ] {\DISMM};
        \addplot[draw=\CBLD,fill=\CBLD,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{3.0}
        ] {\DISMM};
        \addplot[draw=\CMNT,fill=\CMNT,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{4.0}
        ] {\DISMM};
        \addplot[draw=\CNRV,fill=\CNRV,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{5.0}
        ] {\DISMM};
        \addplot[draw=\CCIR,fill=\CCIR,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{6.0}
        ] {\DISMM};
        \addplot[draw=\CRSP,fill=\CRSP,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{7.0}
        ] {\DISMM};
        \addplot[draw=\CDIG,fill=\CDIG,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{8.0}
        ] {\DISMM};
        \addplot[draw=\CGNT,fill=\CGNT,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{9.0}
        ] {\DISMM};
        \addplot[draw=\CSKN,fill=\CSKN,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{11.0}
        ] {\DISMM};
        \addplot[draw=\CMSK,fill=\CMSK,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{12.0}
        ] {\DISMM};
        \addplot[draw=\CCNT,fill=\CCNT,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{13.0}
        ] {\DISMM};
        \addplot[draw=\CPRI,fill=\CPRI,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{14.0}
        ] {\DISMM};
        \addplot[draw=\CILL,fill=\CILL,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{15.0}
        ] {\DISMM};
        \addplot[draw=\CINJ,fill=\CINJ,xbar,area legend,opacity=\OPC,text opacity=\OPC] table [ 
        y expr=\coordindex,
        x=pn, discard if not={icdclass}{16.0}
        ] {\DISMM};
         
        
        % \addlegendentry{Female}
      \end{axis}
    \end{tikzpicture}};

   \node[fill=white,anchor=north west] (T) at ([xshift=-1.7in,yshift=-0.05in]A.north east) {
      \arrayrulecolor{white}
      \setlength\arrayrulewidth{2pt}
      \mnp{2in}{\fontsize{7}{8}\selectfont\color{\TEXTCOL}
        {\large \color{black} ICD9 Class}
        \vskip 1em
        \begin{tabular}{L{.03in}L{1.5in}}
          \cellcolor{\CINF} & Infections \\\hline  %0
          \cellcolor{\CIMM} & Endocrine \& Immun. Dis.\\\hline %2
          %\cellcolor{\COLBI} & Skin \& subcut. tiss.\\\hline    %4
          \cellcolor{\CBLD} & Dis. of Bld. \& Bld.-Form. Org.\\\hline           %5
          \cellcolor{\CDIG} & Digestive Dis.\\\hline           %5
          \cellcolor{\COLBC} & Mental Dis.\\\hline              %6
          \cellcolor{\CNRV} & Nervous Dis.\\\hline             %7
          \cellcolor{\CCIR} & Circulatory Dis.\\\hline         %8
          \cellcolor{\CRSP} & Respiratory Dis.\\\hline         %9
          \cellcolor{\CGNT} & Genitourinary Dis.\\\hline       %11
          \cellcolor{\CCNT} & Congenital Anomaly\\\hline       %13
          \cellcolor{\CPRI} & Cond. orig. in Perinatal Per.\\\hline %14
          \cellcolor{\CILL} & Ill-defined Cond. \& Symp. \\\hline   %15
          \cellcolor{\CMSK} & Musculosk. \& Conn. Tiss.\\\hline   %12
          \cellcolor{\CINJ} & Injury \& Poisoning   \\\hline %16
          \cellcolor{\CNEO} & Neoplasms    %1
          \end{tabular}
        }
      };

\end{tikzpicture}

 